export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).send("Method Not Allowed");
  }

  const { message } = req.body;

  if (!message) {
    console.log("‚ö†Ô∏è –ù–µ—Ç message –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞");
    return res.status(200).send("No message");
  }

  const chatId = message.chat?.id;
  const text = message.text?.toLowerCase() || "";

  const firstName = message.from?.first_name || "";
  const lastName = message.from?.last_name || "";
  const username = message.from?.username || "";
  const userId = message.from?.id;

  // üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  console.log("üÜï –ó–∞–ø—Ä–æ—Å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç:");
  console.log(`üë§ –ò–º—è: ${firstName} ${lastName}`);
  console.log(`üîó Username: @${username}`);
  console.log(`üÜî ID: ${userId}`);
  console.log(`üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ: ${text}`);

  const helpText = `‚ùì <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Go Travel</b>

<b>‚Äî –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã:</b>
‚Ä¢ –ö–∞–∫ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–µ–ª—å?
‚Ä¢ –ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ?
‚Ä¢ –ü–æ—á–µ–º—É –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–µ—Ä–µ–ª—ë—Ç?

‚úçÔ∏è –ù–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å, –∏ –º—ã –æ—Ç–≤–µ—Ç–∏–º –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ.`;

  try {
    if (chatId) {
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º FAQ + –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
      await fetch(`https://api.telegram.org/bot${process.env.BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          text: helpText,
          parse_mode: "HTML",
        }),
      });

      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ –õ–° (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
      const managerChatId = process.env.MANAGER_CHAT_ID; // –∑–∞–¥–∞—ë—Ç—Å—è –≤ .env
      if (managerChatId) {
        const forwardText = `üì• –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É:

üë§ ${firstName} ${lastName} (@${username})
üÜî ID: ${userId}

üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ: ${text}`;

        await fetch(`https://api.telegram.org/bot${process.env.BOT_TOKEN}/sendMessage`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            chat_id: managerChatId,
            text: forwardText,
          }),
        });
      }
    }

    res.status(200).send("ok");
  } catch (error) {
    console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
    res.status(500).send("Error");
  }
}
